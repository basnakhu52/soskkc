<!DOCTYPE html>
<html lang="th">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <title>แดชบอร์ดอุปกรณ์ช่วยเหลือ - ท่าอากาศยานขอนแก่น</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2991/2991108.png" type="image/png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
  /* ...existing code... */
    :root {
      --primary-color: #2563eb;
      --secondary-color: #1e40af;
      --accent-color: #3b82f6;
      --light-bg: #f8fafc;
      --card-bg: #ffffff;
      --text-dark: #1e293b;
      --text-light: #64748b;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
    }
    
    body {
      background-color: var(--light-bg);
      min-height: 100vh;
      font-family: 'Sarabun', sans-serif;
      color: var(--text-dark);
      padding: 0;
      margin: 0;
    }
    
    .dashboard-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .dashboard-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--text-dark);
      margin: 0;
    }
    
    .title-icon {
      background-color: var(--primary-color);
      color: white;
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .refresh-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .refresh-icon {
      color: var(--accent-color);
      animation: spin 2s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .card {
      background-color: var(--card-bg);
      border-radius: 16px;
      border: none;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      margin-bottom: 2rem;
    }
    
    .card-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 1.25rem 1.5rem;
      border-bottom: none;
    }
    
    .card-title {
      font-weight: 600;
      margin: 0;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .table-container {
      overflow-x: auto;
      padding: 0 0.5rem;
    }
    
    .table {
      width: 100%;
      min-width: 800px;
      border-collapse: separate;
      border-spacing: 0;
      margin: 0;
    }
    
    .table thead th {
      background-color: #f1f5f9;
      color: var(--text-dark);
      font-weight: 600;
      padding: 1rem 1.25rem;
      border-bottom: 2px solid #e2e8f0;
      text-align: left;
    }
    
    .table tbody tr {
      transition: all 0.2s ease;
    }
    
    .table tbody tr:hover {
      background: #f5f7fa;
      box-shadow: 0 4px 24px 0 rgba(80,120,200,0.09);
      position: relative;
      z-index: 2;
      transition: background 0.18s, box-shadow 0.18s;
    }
    
    .table tbody td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: middle;
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.35rem 0.75rem;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .badge-primary {
      background-color: #dbeafe;
      color: var(--primary-color);
    }
    
    .badge-success {
      background-color: #dcfce7;
      color: var(--success-color);
    }
    
    .badge-warning {
      background-color: #fef3c7;
      color: var(--warning-color);
    }
    
    .badge-danger {
      background-color: #fee2e2;
      color: var(--danger-color);
    }
    
    .action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .btn-outline {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }
    
    .btn-outline:hover {
      background-color: #eff6ff;
    }
    
    .footer {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e8f0;
    }
    
    .phone-link {
      color: var(--primary-color);
      text-decoration: none;
      transition: color 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .phone-link:hover {
      color: var(--secondary-color);
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .dashboard-container {
        padding: 1.5rem 1rem;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .dashboard-title {
        font-size: 1.5rem;
      }
      
      .card-header {
        padding: 1rem;
      }
      
      .card-title {
        font-size: 1.1rem;
      }
      
      .table thead th,
      .table tbody td {
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="header">
      <div class="title-container">
        <div class="title-icon">
          <i class="bi bi-tools"></i>
        </div>
        <h1 class="dashboard-title">ระบบรายงานเหตุการณ์ท่าอากาศยานขอนแก่น</h1>
      </div>
      <div class="refresh-info">
        <i class="bi bi-arrow-clockwise refresh-icon"></i>
        <span id="equipment-refresh">กำลังอัปเดตข้อมูล...</span>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <i class="bi bi-list-check"></i>
          รายการอุปกรณ์สนับสนุน - ท่าอากาศยานขอนแก่น
        </h2>
      </div>
      <div class="card-body p-0 table-container">
        <div id="equipment-loading" style="padding:2rem;text-align:center;display:none;">
          <div class="spinner-border text-primary" role="status" style="width:2.5rem;height:2.5rem;">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div style="margin-top:1rem;color:#64748b;">กำลังโหลดข้อมูลอุปกรณ์...</div>
        </div>
        <table class="table" id="equipment-table" style="display:none;">
          <thead>
            <tr>
              <th><i class="bi bi-hash" aria-label="ลำดับ"></i> ลำดับ</th>
              <th><i class="bi bi-clock" aria-label="วันที่/เวลา"></i> วันที่/เวลา</th>
              <th><i class="bi bi-building" aria-label="หน่วยงาน"></i> หน่วยงาน</th>
              <th><i class="bi bi-box-seam" aria-label="รายการสนับสนุน"></i> รายการสนับสนุน</th>
              <th><i class="bi bi-people" aria-label="กำลังคน"></i> กำลังคน (จำนวน)</th>
              <th><i class="bi bi-telephone" aria-label="เบอร์โทรติดต่อ"></i> เบอร์โทรติดต่อ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    
    <div class="footer">
      <div style="display:flex;justify-content:center;gap:1rem;flex-wrap:wrap;">
        <a href="event.html" class="action-btn btn-outline">
          <i class="bi bi-arrow-left-circle"></i>
          กลับไปหน้ารายงานเหตุการณ์
        </a>
        <a href="https://docs.google.com/spreadsheets/d/1FEyl81GXg8y4c1J_SN0kadOK6sp5DVFcb3pF-CpHcAE/edit?gid=1324661968#gid=1324661968" target="_blank" class="action-btn btn-outline" style="display:flex;align-items:center;gap:0.5rem;">
          <i class="bi bi-database-fill-gear" style="font-size:1.2rem;"></i>
          แก้ไขข้อมูล
        </a>
        <a href="/" class="action-btn btn-outline" style="display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.9rem;">
          <i class="bi bi-house-door-fill" style="font-size:1.1rem;"></i>
        </a>
      </div>
      <div style="margin-top:1.5rem;font-size:0.95rem;color:#94a3b8;">
        <i class="bi bi-c-circle"></i> พัฒนาโดย Bas-KKC
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://script.google.com/macros/s/AKfycbwIMT2pgUPQXxrf1D7yuiqLbtcCyyMCOWvAZZKRDQNOaonKix2YUzQs4Aog0qLTrJosww/exec";
    


    let firstLoad = true;
    function showEquipmentLoading(show) {
      document.getElementById('equipment-loading').style.display = show ? '' : 'none';
      document.getElementById('equipment-table').style.display = show ? 'none' : '';
    }

    function fetchAndRenderEquipment() {
      if (firstLoad) {
        showEquipmentLoading(true);
      }
      fetch(`${API_BASE}?sheet=equipment`)
        .then(res => res.json())
        .then(data => {
          localStorage.setItem('equipment', JSON.stringify(data));
          renderEquipmentTable(data);
          updateRefreshTime();
          if (firstLoad) {
            showEquipmentLoading(false);
            firstLoad = false;
          }
        })
        .catch(() => {
          const cached = localStorage.getItem('equipment');
          if (cached) {
            renderEquipmentTable(JSON.parse(cached));
            document.getElementById('equipment-refresh').textContent = "อัปเดตล่าสุดจากแคช: " + new Date().toLocaleTimeString('th-TH');
            if (firstLoad) {
              showEquipmentLoading(false);
              firstLoad = false;
            }
          } else {
            document.getElementById('equipment-refresh').textContent = "ไม่สามารถโหลดข้อมูลได้";
            if (firstLoad) {
              showEquipmentLoading(false);
              firstLoad = false;
            }
          }
        });
    }
    
    function updateRefreshTime() {
      const now = new Date();
      const options = { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit',
        hour12: false 
      };
      document.getElementById('equipment-refresh').textContent = 
        "อัปเดตล่าสุด: " + now.toLocaleTimeString('th-TH', options);
    }
    
    function renderEquipmentTable(data) {
      const tbody = document.querySelector('#equipment-table tbody');
      tbody.innerHTML = "";
      // เรียงลำดับตามเวลาใหม่สุดอยู่บนสุด (time: "HH.mmน.")
      function parseTime(str) {
        // รองรับรูปแบบ "09.00น." หรือ "09.12 น." หรือ "9.00น." (มี/ไม่มีช่องว่าง)
        if (!str) return 0;
        const match = str.match(/(\d{1,2})\.(\d{2})/);
        if (!match) return 0;
        const h = parseInt(match[1], 10);
        const m = parseInt(match[2], 10);
        return h * 60 + m;
      }
      data.sort((a, b) => parseTime(b.time) - parseTime(a.time));
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:#64748b;">ไม่พบข้อมูลอุปกรณ์</td></tr>`;
        return;
      }
      // สร้างลำดับใหม่: แถวล่างสุด (เก่าสุด) = 1, ไล่ขึ้นไปจนถึงแถวบนสุด (ใหม่สุด)
      for (let i = 0; i < data.length; i++) {
        const row = data[i];
        const rowNo = data.length - i; // แถวบนสุด (ใหม่สุด) = จำนวนแถว, แถวล่างสุด = 1
        const phoneLink = row.phone ? 
          `<a href="tel:${row.phone}" class="phone-link">
            <i class="bi bi-telephone"></i>
            ${row.phone}
          </a>` : '-';
        tbody.innerHTML += `
          <tr>
            <td>${rowNo}</td>
            <td>${row.time || "-"}</td>
            <td>${row.govement || "-"}</td>
            <td>${row.support_list || "-"}</td>
            <td>${row.people || "-"}</td>
            <td>${phoneLink}</td>
          </tr>
        `;
      }
    }
    
    // อัปเดตข้อมูลทุก 5 วินาที
    setInterval(fetchAndRenderEquipment, 5000);
    fetchAndRenderEquipment();
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>